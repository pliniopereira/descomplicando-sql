# Prompt para DeepSeek: Analisador de Arquivos com Ollama

## üéØ Objetivo
Crie um sistema Python robusto e profissional que:
1. Analise arquivos PowerPoint (.ppt/.pptx) e Excel (.xlsx/.xls) de uma pasta espec√≠fica "analisar/"
2. Envie o conte√∫do extra√≠do para Ollama via biblioteca Python
3. Execute agentes Python baseados na resposta do Ollama
4. **Salve resultados em arquivos na pasta "processados/" com timestamp e nome original**

## üìã Requisitos T√©cnicos

### Funcionalidades Principais:
- **Escaneamento autom√°tico** da pasta "analisar/"
- **Detec√ß√£o autom√°tica** de tipos de arquivo (PPT/Excel)
- **Extra√ß√£o inteligente** de conte√∫do (texto, tabelas, dados)
- **Integra√ß√£o robusta** com Ollama via biblioteca Python
- **Execu√ß√£o segura** de c√≥digo Python gerado
- **Salvamento autom√°tico** na pasta "processados/" com formato: `YYYYMMDD_HHMMSS_nome_original.json`
- **Interface CLI** interativa e amig√°vel

### Estrutura de Pastas:
```
projeto/
‚îú‚îÄ‚îÄ analyzer.py
‚îú‚îÄ‚îÄ analisar/           # Pasta de entrada (arquivos para processar)
‚îÇ   ‚îú‚îÄ‚îÄ relatorio.xlsx
‚îÇ   ‚îî‚îÄ‚îÄ apresentacao.pptx
‚îî‚îÄ‚îÄ processados/        # Pasta de sa√≠da (resultados com timestamp)
    ‚îú‚îÄ‚îÄ 20240904_143052_relatorio.json
    ‚îú‚îÄ‚îÄ 20240904_143125_apresentacao.json
    ‚îî‚îÄ‚îÄ ...
```

### Bibliotecas Necess√°rias:
```python
# Ollama - Biblioteca Python oficial
import ollama

# Processamento de arquivos
import pandas as pd
from pptx import Presentation  # python-pptx
import openpyxl

# Sistema e utilit√°rios
import os, sys, logging
import json
from pathlib import Path
from typing import Dict, List, Optional, Any
from dataclasses import dataclass
from datetime import datetime
import asyncio  # Para opera√ß√µes ass√≠ncronas
```

### Instala√ß√£o:
```bash
pip install ollama pandas python-pptx openpyxl
```

## üèóÔ∏è Arquitetura Solicitada

### 1. Classes Principais:
```python
@dataclass
class FileInfo:
    """Estrutura para informa√ß√µes do arquivo"""
    path: str
    name: str
    type: str  # "PowerPoint" ou "Excel"
    size: int
    extension: str

class FileAnalyzer:
    """Analisador principal de arquivos"""
    def __init__(self):
        self.ollama_client = OllamaClient()
        self.setup_logging()
        self.setup_folders()
    
    def setup_logging(self):
        """Configura logging profissional"""
        pass
    
    def setup_folders(self):
        """Cria pastas necess√°rias se n√£o existirem"""
        os.makedirs("analisar", exist_ok=True)
        os.makedirs("processados", exist_ok=True)
    
    def scan_folder(self, folder_path: str = "analisar") -> List[FileInfo]:
        """Escaneia pasta e retorna arquivos suportados"""
        pass
    
    def extract_content(self, file_info: FileInfo) -> str:
        """Extrai conte√∫do baseado no tipo do arquivo"""
        pass
    
    def send_to_ollama(self, content: str, model: str = "llama2") -> Dict:
        """Envia para Ollama usando biblioteca Python"""
        pass
    
    def execute_agent(self, code: str, context: Dict = None) -> Dict:
        """Executa c√≥digo de forma segura"""
        pass
    
    def save_results(self, file_info: FileInfo, analysis_result: Dict) -> str:
        """Salva resultados na pasta processados com timestamp"""
        # Formato: YYYYMMDD_HHMMSS_nome_original.json
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        base_name = Path(file_info.name).stem
        output_filename = f"{timestamp}_{base_name}.json"
        output_path = os.path.join("processados", output_filename)
        
        # Estrutura completa do resultado
        complete_result = {
            "timestamp": timestamp,
            "processed_at": datetime.now().isoformat(),
            "source_file": {
                "name": file_info.name,
                "path": file_info.path,
                "type": file_info.type,
                "size": file_info.size
            },
            "analysis": analysis_result,
            "metadata": {
                "analyzer_version": "1.0.0",
                "model_used": "llama2"
            }
        }
        
        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(complete_result, f, indent=2, ensure_ascii=False)
        
        return output_path
    
    def process_file(self, file_info: FileInfo, model: str = "llama2") -> Dict:
        """Pipeline completo: extrair -> analisar -> executar -> salvar"""
        pass

class OllamaClient:
    """Cliente para intera√ß√£o com Ollama usando biblioteca Python"""
    def __init__(self):
        pass
    
    def generate(self, prompt: str, model: str = "llama2", 
                options: Dict = None) -> Dict:
        """Gera resposta usando ollama.generate()"""
        try:
            response = ollama.generate(
                model=model,
                prompt=prompt,
                options=options or {"temperature": 0.7}
            )
            return {
                "success": True,
                "response": response["response"],
                "model": model,
                "context": response.get("context", [])
            }
        except Exception as e:
            return {"success": False, "error": str(e)}
    
    def chat(self, messages: List[Dict], model: str = "llama2") -> Dict:
        """Chat usando ollama.chat() para conversas contextuais"""
        try:
            response = ollama.chat(
                model=model,
                messages=messages
            )
            return {
                "success": True,
                "response": response["message"]["content"],
                "model": model
            }
        except Exception as e:
            return {"success": False, "error": str(e)}
    
    def list_models(self) -> List[str]:
        """Lista modelos dispon√≠veis usando ollama.list()"""
        try:
            models = ollama.list()
            return [model["name"] for model in models["models"]]
        except Exception as e:
            logging.error(f"Erro ao listar modelos: {e}")
            return []
    
    def pull_model(self, model: str) -> bool:
        """Baixa modelo se n√£o existir usando ollama.pull()"""
        try:
            ollama.pull(model)
            return True
        except Exception as e:
            logging.error(f"Erro ao baixar modelo {model}: {e}")
            return False
```

### 2. Funcionalidades Espec√≠ficas:

#### PowerPoint (.ppt/.pptx):
- Extrair texto de todos os slides
- Capturar conte√∫do de tabelas e gr√°ficos
- Identificar t√≠tulos e subt√≠tulos
- Extrair notas do apresentador (se houver)
- Manter estrutura hier√°rquica

#### Excel (.xlsx/.xls):
- Processar todas as abas
- Extrair dados estruturados
- Calcular estat√≠sticas b√°sicas
- Identificar tipos de dados
- Detectar f√≥rmulas importantes
- Preservar formata√ß√£o relevante

### 3. Sistema de Salvamento:

#### Formato dos Arquivos de Sa√≠da:
```json
{
  "timestamp": "20240904_143052",
  "processed_at": "2024-09-04T14:30:52.123456",
  "source_file": {
    "name": "relatorio.xlsx",
    "path": "analisar/relatorio.xlsx",
    "type": "Excel",
    "size": 1024000
  },
  "analysis": {
    "resumo": "string",
    "insights": ["insight1", "insight2"],
    "recomendacoes": ["rec1", "rec2"],
    "codigo_agente": "print('Hello')",
    "execution_result": {
      "success": true,
      "output": "Hello"
    }
  },
  "metadata": {
    "analyzer_version": "1.0.0",
    "model_used": "llama2",
    "processing_time_seconds": 45.2
  }
}
```

#### Nomenclatura dos Arquivos:
- **Formato**: `YYYYMMDD_HHMMSS_nome_original.json`
- **Exemplos**:
  - `20240904_143052_relatorio.json`
  - `20240904_143125_apresentacao_vendas.json`
  - `20240904_150000_dados_financeiros.json`

### 4. Integra√ß√£o com Ollama (Biblioteca Python):

#### M√©todos Principais da Biblioteca:
```python
import ollama

# 1. Gera√ß√£o de texto simples
response = ollama.generate(
    model='llama2',
    prompt='Analise este conte√∫do...',
    options={
        'temperature': 0.7,
        'top_p': 0.9,
        'max_tokens': 2000
    }
)

# 2. Chat contextual (recomendado para an√°lises)
messages = [
    {
        'role': 'system', 
        'content': 'Voc√™ √© um especialista em an√°lise de dados...'
    },
    {
        'role': 'user', 
        'content': 'Analise este conte√∫do e retorne c√≥digo Python...'
    }
]
response = ollama.chat(model='llama2', messages=messages)

# 3. Listar modelos dispon√≠veis
models = ollama.list()
available_models = [model['name'] for model in models['models']]

# 4. Baixar modelo automaticamente
ollama.pull('llama2')
```

## üéØ Prompt Template para Ollama:
```
Voc√™ √© um analista de dados especializado. Analise o conte√∫do fornecido e retorne:

1. **RESUMO EXECUTIVO** (2-3 frases principais)
2. **INSIGHTS CHAVE** (m√°ximo 5 pontos)
3. **RECOMENDA√á√ïES** (a√ß√µes pr√°ticas)
4. **C√ìDIGO AGENTE** (Python funcional para automa√ß√£o)

**REGRAS IMPORTANTES:**
- Use formato JSON estruturado
- O c√≥digo deve ser execut√°vel e seguro
- Foque em insights acion√°veis
- Seja conciso mas preciso

**CONTE√öDO PARA AN√ÅLISE:**
{content}

**RESPOSTA ESPERADA (JSON):**
{
  "resumo": "string",
  "insights": ["string1", "string2", ...],
  "recomendacoes": ["string1", "string2", ...],
  "codigo_agente": "string com c√≥digo Python"
}
```

## ‚ö° Boas Pr√°ticas Obrigat√≥rias:

### 1. **Logging Profissional**:
```python
import logging
from datetime import datetime

# Configura√ß√£o de logging com rota√ß√£o
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler(f'analyzer_{datetime.now():%Y%m%d}.log'),
        logging.StreamHandler()
    ]
)
```

### 2. **Controle de Arquivos Processados**:
- Verificar se arquivo j√° foi processado (opcional)
- Log de todos os arquivos processados
- Backup autom√°tico da pasta processados

### 3. **Tratamento de Erros**:
- Salvar erros tamb√©m em arquivos JSON
- Continue processando outros arquivos em caso de erro
- Log detalhado de falhas

### 4. **Interface CLI Melhorada**:
```
üîç Escaneando pasta 'analisar'...
üìã Arquivos encontrados:
   1. relatorio.xlsx (Excel) - 1.2 MB
   2. apresentacao.pptx (PowerPoint) - 850 KB

üöÄ Processando arquivos...
‚úÖ relatorio.xlsx ‚Üí processados/20240904_143052_relatorio.json
‚úÖ apresentacao.pptx ‚Üí processados/20240904_143125_apresentacao.json

üìä Resumo:
   - 2 arquivos processados
   - Pasta de sa√≠da: processados/
   - Tempo total: 2m 15s
```

## üöÄ Exemplo de Implementa√ß√£o do Main:
```python
def main():
    analyzer = FileAnalyzer()
    
    # Verificar modelos Ollama
    models = ollama.list()
    if not any('llama2' in model['name'] for model in models['models']):
        print("üì• Baixando modelo llama2...")
        ollama.pull('llama2')
    
    # Processar arquivos
    files = analyzer.scan_folder("analisar")
    
    if not files:
        print("‚ùå Nenhum arquivo encontrado na pasta 'analisar/'")
        return
    
    print(f"üöÄ Processando {len(files)} arquivo(s)...")
    
    results = []
    for file_info in files:
        print(f"üìÑ Processando: {file_info.name}")
        
        # Processar arquivo completo
        result = analyzer.process_file(file_info)
        
        if result['success']:
            # Salvar na pasta processados
            output_path = analyzer.save_results(file_info, result)
            print(f"‚úÖ Salvo em: {output_path}")
            results.append(output_path)
        else:
            print(f"‚ùå Erro: {result['error']}")
    
    print(f"\nüìä Conclu√≠do! {len(results)} arquivo(s) processado(s)")
    print(f"üìÅ Resultados salvos na pasta 'processados/'")

if __name__ == "__main__":
    main()
```

## üîß **COMANDOS ESPEC√çFICOS PARA DEEPSEEK:**

**Gere o c√≥digo completo seguindo EXATAMENTE esta estrutura:**

1. **Imports e configura√ß√µes iniciais**
2. **Classe FileInfo (dataclass)**  
3. **Classe OllamaClient** - usando `import ollama`
4. **Classe FileAnalyzer** - com m√©todo `save_results()` obrigat√≥rio
5. **Fun√ß√£o main()** - interface CLI com salvamento autom√°tico
6. **Sistema de pastas** - cria√ß√£o autom√°tica de "analisar/" e "processados/"
7. **Nomenclatura de arquivos** - formato `YYYYMMDD_HHMMSS_nome.json`
8. **Tratamento de erros robusto**
9. **Logging profissional**
10. **Documenta√ß√£o completa**

## üìù **REQUIREMENTS.TXT a incluir:**
```
ollama>=0.1.7
pandas>=1.5.0
python-pptx>=0.6.21
openpyxl>=3.1.0
```

## üéØ **RESULTADO ESPERADO:**
- C√≥digo Python completo e funcional
- Sistema de salvamento autom√°tico na pasta "processados/"
- Arquivos com timestamp no nome (YYYYMMDD_HHMMSS_nome.json)
- Seguindo PEP8 e type hints
- Interface CLI intuitiva com feedback visual
- Logging detalhado
- Pronto para produ√ß√£o

**GERE O C√ìDIGO COMPLETO AGORA COM SISTEMA DE SALVAMENTO OBRIGAT√ìRIO!**